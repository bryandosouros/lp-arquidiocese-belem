<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="post-title-meta">Carregando... - Arquidiocese de Bel√©m do Par√°</title>
    
    <!-- Dynamic SEO Meta Tags -->
    <meta name="description" id="post-description-meta" content="Arquidiocese de Bel√©m do Par√°">
    <meta name="keywords" id="post-keywords-meta" content="Arquidiocese, Bel√©m, Par√°, Igreja Cat√≥lica">
    <meta name="author" content="Arquidiocese de Bel√©m do Par√°">
    <meta name="robots" content="index, follow">
    <link rel="canonical" id="post-canonical" href="">
    
    <!-- Dynamic Open Graph Meta Tags -->
    <meta property="og:type" content="article">
    <meta property="og:title" id="og-title" content="">
    <meta property="og:description" id="og-description" content="">
    <meta property="og:image" id="og-image" content="">
    <meta property="og:url" id="og-url" content="">
    <meta property="og:site_name" content="Arquidiocese de Bel√©m do Par√°">
    <meta property="og:locale" content="pt_BR">
    <meta property="article:author" content="Arquidiocese de Bel√©m do Par√°">
    <meta property="article:published_time" id="article-published" content="">
    <meta property="article:section" id="article-section" content="">
    
    <!-- Dynamic Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="">
    <meta name="twitter:description" id="twitter-description" content="">
    <meta name="twitter:image" id="twitter-image" content="">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0c4a6e">
    <link rel="icon" type="image/x-icon" href="images/logo-arquidiocese-belem.png">
    
    <!-- Dynamic JSON-LD Structured Data -->
    <script type="application/ld+json" id="structured-data">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "",
        "description": "",
        "image": "",
        "author": {
            "@type": "Organization",
            "name": "Arquidiocese de Bel√©m do Par√°"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Arquidiocese de Bel√©m do Par√°",
            "logo": {
                "@type": "ImageObject",
                "url": ""
            }
        },
        "datePublished": "",
        "dateModified": "",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": ""
        }
    }
    </script>
    
    <link rel="icon" type="image/png" href="images/logo-arquidiocese-belem.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/base.css">
    
    <!-- Dynamic JSON-LD Structured Data -->
    <script type="application/ld+json" id="structured-data"></script>
</head>
<body>
   <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/logo-arquidiocese-belem.png" alt="Arquidiocese de Bel√©m">
                        <div class="header-logo-texto">
                            <span>Arquidiocese de<br></span>
                            <span>Bel√©m do Par√°</span>
                        </div>
                    </a>
                </div>
                
                <nav class="nav" id="nav">
                    <ul class="nav-list">
                        <li><a href="index.html" class="active">In√≠cio</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle">Documentos <i class="fas fa-chevron-down"></i></a>
                            <ul class="dropdown-menu">
                                <li><a href="celebracao_da_palavra.html">Celebra√ß√£o da Palavra</a></li>
                                <li><a href="#">Orienta√ß√µes Lit√∫rgicas</a></li>
                                <li><a href="#">Cartas Pastorais</a></li>
                            </ul>
                        </li>
                        <li><a href="#sobre">Sobre</a></li>
                        <li><a href="#contato">Contato</a></li>
                    </ul>
                </nav>
                
                <div class="header-actions">
                    <a href="login.html" class="curia-digital-btn">
                        <i class="fas fa-shield-alt"></i>
                        <span>C√∫ria Digital</span>
                    </a>
                </div>
                
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main id="conteudo-principal">
        <div class="container">
            <article class="post-content" id="post-container">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Carregando conte√∫do...</p>
                </div>
            </article>
            
            <!-- Comments Section -->
            <section id="comments-section" class="comments-section section-engagement">
                <div class="comments-header">
                    <h3 class="comments-title">
                        <span class="comments-icon">üí¨</span>
                        Coment√°rios
                    </h3>
                    <div class="comments-stats">
                        <span id="comments-count">0</span> coment√°rios
                    </div>
                </div>
                
                <!-- Comments Form Container -->
                <div id="comments-form-container" class="comments-form-container">
                    <!-- Form will be dynamically created by comment-system.js -->
                </div>
                
                <!-- Comments List Container -->
                <div id="comments-list-container" class="comments-list-container">
                    <!-- Comments will be dynamically loaded by comment-system.js -->
                </div>
            </section>
            
            <!-- Social Share Section -->
            <section id="post-share-section" class="post-share-section section-engagement">
                <div class="share-header">
                    <h3 class="share-title">Compartilhar este conte√∫do</h3>
                </div>
                <div class="social-share-container">
                    <button class="social-share-btn facebook share-btn" data-platform="facebook">
                        <span>üìò</span> Facebook
                    </button>
                    <button class="social-share-btn twitter share-btn" data-platform="twitter">
                        <span>üê¶</span> Twitter
                    </button>
                    <button class="social-share-btn whatsapp share-btn" data-platform="whatsapp">
                        <span>üí¨</span> WhatsApp
                    </button>
                    <button class="social-share-btn telegram share-btn" data-platform="telegram">
                        <span>‚úàÔ∏è</span> Telegram
                    </button>
                    <button class="social-share-btn email share-btn" data-platform="email">
                        <span>üìß</span> Email
                    </button>
                    <button class="social-share-btn copy share-btn" data-platform="copy">
                        <span>üìã</span> Copiar Link
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer id="rodape-principal" class="site-footer footer-vatican-inspired">
        <div class="container">
            <div class="footer-conteudo">
                <div class="footer-logo-area">
                    <img src="images/logo-arquidiocese-belem.png" alt="Logo da Arquidiocese" class="footer-logo-imagem">
                    <div class="footer-logo-texto">
                        <span>Arquidiocese de</span>
                        <span>Bel√©m do Par√°</span>
                    </div>
                </div>
                <div class="footer-info">
                     <p>Este √© um projeto fict√≠cio para o jogo Habbo Hotel e n√£o possui qualquer v√≠nculo com a Arquidiocese de Bel√©m da vida real.</p>
                </div>
            </div>
            <div class="footer-copyright">
                 <p>&copy; <span id="ano-atual"></span> Arquidiocese de Bel√©m do Par√° (Habbo). Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Push Notification Modal -->
    <div id="push-notification-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîî Receber Notifica√ß√µes</h3>
                <button class="modal-close" onclick="this.closest('.modal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <p>Gostou deste conte√∫do? Receba notifica√ß√µes sobre novos posts, eventos e comunicados da Arquidiocese.</p>
                <div class="notification-benefits">
                    <ul>
                        <li>‚úÖ Novos posts e artigos</li>
                        <li>üìÖ Eventos importantes</li>
                        <li>üìã Comunicados oficiais</li>
                        <li>üôè Momentos de ora√ß√£o</li>
                    </ul>
                </div>
                <div class="notification-controls">
                    <button id="enable-notifications" class="btn btn-primary">
                        Ativar Notifica√ß√µes
                    </button>
                    <button class="btn btn-secondary" onclick="this.closest('.modal').style.display='none'">
                        Talvez Depois
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/post.js"></script>
    <script src="js/darkmode.js" defer></script>
    
    <!-- Mobile UX Enhancement - Release 6A -->
    <script src="js/mobile-ux.js" defer></script>
    <script src="js/mobile-gestures.js" defer></script>
    <script src="js/mobile-forms.js" defer></script>
    
    <!-- Release 6B: Advanced PWA Features -->
    <script src="js/advanced-pwa-controller.js" defer></script>
    <script src="js/pwa-performance-monitor.js" defer></script>
    
    <!-- Analytics & SEO Scripts -->
    <script type="module" src="js/analytics-manager.js"></script>
    <script type="module" src="js/seo-manager.js"></script>
    <script type="module" src="js/sitemap-generator.js"></script>
    
    <!-- Engagement & Interaction Scripts -->
    <script type="module" src="js/comment-system.js"></script>
    <script type="module" src="js/newsletter-system.js"></script>
    <script type="module" src="js/whatsapp-integration.js"></script>
    <script type="module" src="js/push-notification-manager.js"></script>
    <script type="module" src="js/notification-system.js"></script>
    
    <!-- Analytics Manager -->
    <script src="js/analytics-manager.js"></script>
    <script>
        // Initialize post-specific analytics
        document.addEventListener('DOMContentLoaded', function() {
            if (window.analyticsManager) {
                // Track post page view (will be updated when post loads)
                analyticsManager.trackEvent('page_view', {
                    page_title: document.title,
                    page_location: window.location.href,
                    content_group1: 'Post',
                    content_group2: 'Arquidiocese'
                });
                
                // Setup post-specific tracking
                setupPostTracking();
            }
        });
        
        function setupPostTracking() {
            // Track reading progress
            const postContent = document.querySelector('.post-content');
            if (postContent) {
                analyticsManager.trackScrollDepth(postContent, 'post_content');
                analyticsManager.trackTimeOnPage();
            }
            
            // Track share buttons (when implemented)
            document.querySelectorAll('.share-button, [data-share]').forEach(button => {
                button.addEventListener('click', function() {
                    const shareType = this.dataset.share || 'unknown';
                    analyticsManager.trackEvent('share', {
                        method: shareType,
                        content_type: 'post',
                        content_id: new URLSearchParams(window.location.search).get('id') || 'unknown'
                    });
                });
            });
            
            // Track external link clicks
            document.querySelectorAll('a[href^="http"]:not([href*="arquidiocese-belem"])').forEach(link => {
                link.addEventListener('click', function() {
                    analyticsManager.trackEvent('click', {
                        link_classes: 'external_link',
                        link_domain: new URL(this.href).hostname,
                        link_url: this.href,
                        outbound: true
                    });
                });
            });
        }
        
        // Function to update SEO meta tags when post loads
        window.updatePostSEO = function(post) {
            if (!post) return;
            
            const baseUrl = 'https://arquidiocese-belem.web.app';
            const postUrl = `${baseUrl}/post.html?id=${post.id}`;
            const postImage = post.featuredImage || `${baseUrl}/images/logo-arquidiocese-belem.png`;
            
            // Update title and meta description
            document.getElementById('post-title-meta').textContent = `${post.title} - Arquidiocese de Bel√©m do Par√°`;
            document.getElementById('post-description-meta').content = post.excerpt || post.content.substring(0, 160);
            document.getElementById('post-keywords-meta').content = `${post.tags ? post.tags.join(', ') + ', ' : ''}Arquidiocese, Bel√©m, Par√°, Igreja Cat√≥lica`;
            document.getElementById('post-canonical').href = postUrl;
            
            // Update Open Graph
            document.getElementById('og-title').content = post.title;
            document.getElementById('og-description').content = post.excerpt || post.content.substring(0, 200);
            document.getElementById('og-image').content = postImage;
            document.getElementById('og-url').content = postUrl;
            document.getElementById('article-published').content = post.publishedAt || post.createdAt;
            document.getElementById('article-section').content = post.category || 'Not√≠cias';
            
            // Update Twitter Card
            document.getElementById('twitter-title').content = post.title;
            document.getElementById('twitter-description').content = post.excerpt || post.content.substring(0, 200);
            document.getElementById('twitter-image').content = postImage;
            
            // Update JSON-LD
            const structuredData = {
                "@context": "https://schema.org",
                "@type": "Article",
                "headline": post.title,
                "description": post.excerpt || post.content.substring(0, 200),
                "image": postImage,
                "author": {
                    "@type": "Organization",
                    "name": "Arquidiocese de Bel√©m do Par√°"
                },
                "publisher": {
                    "@type": "Organization",
                    "name": "Arquidiocese de Bel√©m do Par√°",
                    "logo": {
                        "@type": "ImageObject",
                        "url": `${baseUrl}/images/logo-arquidiocese-belem.png`
                    }
                },
                "datePublished": post.publishedAt || post.createdAt,
                "dateModified": post.updatedAt || post.createdAt,
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": postUrl
                }
            };
            
            document.getElementById('structured-data').textContent = JSON.stringify(structuredData);
            
            // Track updated post view with analytics
            if (window.analyticsManager) {
                analyticsManager.trackEvent('page_view', {
                    page_title: post.title,
                    page_location: postUrl,
                    content_group1: 'Post',
                    content_group2: post.category || 'Not√≠cias',
                    content_id: post.id
                });
                
                analyticsManager.trackContentEngagement(post.id, 'view', {
                    content_type: 'post',
                    content_title: post.title,
                    content_category: post.category
                });
            }
            
            // Initialize Engagement Systems for this post
            initializePostEngagement(post);
        };
        
        // Initialize engagement systems for post page
        function initializePostEngagement(post) {
            try {
                // Initialize Comments for this post
                if (window.commentSystem) {
                    const commentsSection = document.getElementById('comments-section');
                    if (commentsSection && post.id) {
                        window.commentSystem.loadComments(post.id);
                    }
                }
                
                // Initialize Social Sharing with post data
                if (window.whatsappIntegration) {
                    // Add WhatsApp share button specifically for this post
                    const whatsappShareBtn = document.querySelector('.social-share-btn.whatsapp');
                    if (whatsappShareBtn) {
                        whatsappShareBtn.addEventListener('click', () => {
                            const shareText = `${post.title}\n\n${post.excerpt || 'Confira este conte√∫do da Arquidiocese de Bel√©m do Par√°'}\n\n${window.location.href}`;
                            window.whatsappIntegration.sendWhatsAppMessage(shareText);
                        });
                    }
                }
                
                // Setup sharing for all platforms
                setupPostSharing(post);
                
                // Show push notification prompt if user reads enough
                setupPushNotificationPrompt(post);
                
                console.log('‚úÖ Post engagement systems initialized');
            } catch (error) {
                console.error('‚ùå Error initializing post engagement systems:', error);
            }
        }
        
        // Setup sharing functionality
        function setupPostSharing(post) {
            const shareData = {
                title: post.title,
                text: post.excerpt || 'Confira este conte√∫do da Arquidiocese de Bel√©m do Par√°',
                url: window.location.href
            };
            
            document.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const platform = btn.dataset.platform;
                    
                    switch (platform) {
                        case 'facebook':
                            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareData.url)}`, '_blank');
                            break;
                        case 'twitter':
                            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareData.text)}&url=${encodeURIComponent(shareData.url)}`, '_blank');
                            break;
                        case 'whatsapp':
                            window.open(`https://wa.me/?text=${encodeURIComponent(shareData.text + ' ' + shareData.url)}`, '_blank');
                            break;
                        case 'telegram':
                            window.open(`https://t.me/share/url?url=${encodeURIComponent(shareData.url)}&text=${encodeURIComponent(shareData.text)}`, '_blank');
                            break;
                        case 'email':
                            window.location.href = `mailto:?subject=${encodeURIComponent(shareData.title)}&body=${encodeURIComponent(shareData.text + '\n\n' + shareData.url)}`;
                            break;
                        case 'copy':
                            navigator.clipboard.writeText(shareData.url).then(() => {
                                if (window.notificationSystem) {
                                    window.notificationSystem.createNotification({
                                        type: 'success',
                                        title: 'Link Copiado',
                                        message: 'O link foi copiado para a √°rea de transfer√™ncia!',
                                        icon: 'üìã'
                                    });
                                }
                            });
                            break;
                    }
                    
                    // Track share event
                    if (window.analyticsManager) {
                        window.analyticsManager.trackEvent('share', {
                            method: platform,
                            content_type: 'post',
                            content_id: post.id,
                            content_title: post.title
                        });
                    }
                });
            });
        }
        
        // Setup push notification prompt based on reading engagement
        function setupPushNotificationPrompt(post) {
            if (!window.pushNotificationManager) return;
            
            let hasScrolledEnough = false;
            let timeOnPage = 0;
            
            // Track time on page
            const timeInterval = setInterval(() => {
                timeOnPage += 1000; // 1 second
            }, 1000);
            
            // Track scroll depth
            window.addEventListener('scroll', () => {
                const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
                
                if (scrollPercent > 60 && !hasScrolledEnough) {
                    hasScrolledEnough = true;
                    
                    // Show notification prompt if user has read enough and spent time
                    setTimeout(() => {
                        if (timeOnPage > 30000 && !localStorage.getItem('pushNotificationAsked')) { // 30 seconds
                            showPushNotificationPrompt();
                        }
                    }, 5000);
                }
            });
            
            // Cleanup interval when leaving page
            window.addEventListener('beforeunload', () => {
                clearInterval(timeInterval);
            });
        }
        
        function showPushNotificationPrompt() {
            const modal = document.getElementById('push-notification-modal');
            if (modal) {
                modal.style.display = 'flex';
                
                // Enable notifications button
                const enableBtn = document.getElementById('enable-notifications');
                enableBtn.addEventListener('click', async () => {
                    try {
                        const success = await window.pushNotificationManager.enableNotifications();
                        if (success) {
                            if (window.notificationSystem) {
                                window.notificationSystem.createNotification({
                                    type: 'success',
                                    title: 'Notifica√ß√µes Ativadas',
                                    message: 'Voc√™ receber√° notifica√ß√µes sobre novos conte√∫dos!',
                                    icon: 'üîî'
                                });
                            }
                        }
                        modal.style.display = 'none';
                    } catch (error) {
                        console.error('Error enabling notifications:', error);
                    }
                });
                
                // Mark as asked
                localStorage.setItem('pushNotificationAsked', 'true');
            }
        }
        
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const nav = document.getElementById('nav');
            
            if (mobileMenuBtn && nav) {
                mobileMenuBtn.addEventListener('click', function() {
                    nav.classList.toggle('active');
                    mobileMenuBtn.classList.toggle('active');
                });
            }
        });
    </script>
</body>
</html>
