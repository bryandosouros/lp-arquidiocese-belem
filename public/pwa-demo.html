<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Demo - Arquidiocese de Bel√©m</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Demonstra√ß√£o das funcionalidades PWA da Arquidiocese">
    <meta name="theme-color" content="#1a365d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Arquidiocese PWA">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="images/logo-arquidiocese-belem.png">
    <link rel="apple-touch-icon" href="images/logo-arquidiocese-belem.png">
    
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .pwa-demo {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .demo-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .demo-section h3 {
            color: #1a365d;
            margin-bottom: 1rem;
        }
        
        .demo-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .demo-btn {
            background: #1a365d;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .demo-btn:hover {
            background: #2c5282;
            transform: translateY(-1px);
        }
        
        .demo-btn.secondary {
            background: #6b7280;
        }
        
        .demo-btn.secondary:hover {
            background: #4b5563;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #ef4444;
        }
        
        .demo-output {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            border-left: 4px solid #1a365d;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
        }
        
        .feature-list li::before {
            content: '‚úÖ';
            margin-right: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="pwa-demo">
        <h1>üöÄ PWA Demo - Release 4B</h1>
        <p><strong>Arquidiocese de Bel√©m do Par√°</strong> - Progressive Web App</p>
        
        <!-- Status Section -->
        <div class="demo-section">
            <h3>üìä Status do PWA</h3>
            <p>
                <span class="status-indicator" id="connection-status-dot"></span>
                Conex√£o: <span id="connection-status-text">Verificando...</span>
            </p>
            <p>Service Worker: <span id="sw-status">Verificando...</span></p>
            <p>PWA Instalado: <span id="pwa-installed-status">Verificando...</span></p>
            <p>Notifica√ß√µes: <span id="notification-permission">Verificando...</span></p>
        </div>
        
        <!-- Installation Section -->
        <div class="demo-section">
            <h3>üì± Instala√ß√£o do App</h3>
            <p>Teste as funcionalidades de instala√ß√£o do PWA:</p>
            <div class="demo-buttons">
                <button class="demo-btn" onclick="testInstallPrompt()">Mostrar Prompt de Instala√ß√£o</button>
                <button class="demo-btn secondary" onclick="checkInstallStatus()">Verificar Status</button>
            </div>
            <div class="demo-output" id="install-output">Aguardando teste...</div>
        </div>
        
        <!-- Notifications Section -->
        <div class="demo-section">
            <h3>üîî Sistema de Notifica√ß√µes</h3>
            <p>Teste as notifica√ß√µes em tempo real:</p>
            <div class="demo-buttons">
                <button class="demo-btn" onclick="requestNotificationPermission()">Solicitar Permiss√£o</button>
                <button class="demo-btn" onclick="testInAppNotification()">Notifica√ß√£o In-App</button>
                <button class="demo-btn" onclick="testPushNotification()">Push Notification</button>
                <button class="demo-btn secondary" onclick="testNotificationCenter()">Central de Notifica√ß√µes</button>
            </div>
            <div class="demo-output" id="notification-output">Aguardando teste...</div>
        </div>
        
        <!-- Offline Section -->
        <div class="demo-section">
            <h3>üì¥ Funcionalidades Offline</h3>
            <p>Teste o funcionamento offline e sincroniza√ß√£o:</p>
            <div class="demo-buttons">
                <button class="demo-btn" onclick="simulateOffline()">Simular Offline</button>
                <button class="demo-btn" onclick="testOfflineCache()">Testar Cache</button>
                <button class="demo-btn" onclick="testBackgroundSync()">Background Sync</button>
                <button class="demo-btn secondary" onclick="clearOfflineData()">Limpar Cache</button>
            </div>
            <div class="demo-output" id="offline-output">Aguardando teste...</div>
        </div>
        
        <!-- Update Section -->
        <div class="demo-section">
            <h3>üîÑ Atualiza√ß√µes do App</h3>
            <p>Teste o sistema de atualiza√ß√µes:</p>
            <div class="demo-buttons">
                <button class="demo-btn" onclick="checkForUpdates()">Verificar Atualiza√ß√µes</button>
                <button class="demo-btn" onclick="simulateUpdate()">Simular Atualiza√ß√£o</button>
                <button class="demo-btn secondary" onclick="showUpdateBanner()">Banner de Update</button>
            </div>
            <div class="demo-output" id="update-output">Aguardando teste...</div>
        </div>
        
        <!-- Features Summary -->
        <div class="demo-section">
            <h3>‚ú® Recursos Implementados</h3>
            <ul class="feature-list">
                <li>Service Worker com cache inteligente</li>
                <li>Manifest.json completo para instala√ß√£o</li>
                <li>Sistema de notifica√ß√µes em tempo real</li>
                <li>Funcionalidade offline e sincroniza√ß√£o</li>
                <li>Prompt de instala√ß√£o personalizado</li>
                <li>Indicadores de conex√£o e status</li>
                <li>Sistema de atualiza√ß√µes autom√°ticas</li>
                <li>Background sync para dados</li>
                <li>Cache de conte√∫do para leitura offline</li>
                <li>Push notifications</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <a href="index.html" class="demo-btn">‚¨ÖÔ∏è Voltar ao Site Principal</a>
        </div>
    </div>

    <!-- PWA Demo and Analytics Scripts -->
    <script type="module" src="js/analytics-manager.js"></script>
    <script type="module" src="js/seo-manager.js"></script>
    <script type="module">
        // PWA Demo Functions
        window.addEventListener('load', async () => {
            console.log('üß™ PWA Demo loaded');
            
            // Import PWA modules
            try {
                await import('./js/pwa-manager.js');
                await import('./js/notification-system.js');
                await import('./js/offline-cache-manager.js');
                console.log('‚úÖ PWA modules loaded for demo');
                
                // Track PWA demo page view
                if (window.analyticsManager) {
                    window.analyticsManager.trackEvent('page_view', {
                        page_title: 'PWA Demo - Arquidiocese de Bel√©m do Par√°',
                        page_location: window.location.href,
                        content_group1: 'PWA Demo',
                        content_group2: 'Technical'
                    });
                }
            } catch (error) {
                console.error('‚ùå Error loading PWA modules:', error);
            }
            
            updateStatus();
            setupEventListeners();
        });
        
        function updateStatus() {
            // Connection status
            const isOnline = navigator.onLine;
            const statusDot = document.getElementById('connection-status-dot');
            const statusText = document.getElementById('connection-status-text');
            
            if (isOnline) {
                statusDot.className = 'status-indicator status-online';
                statusText.textContent = 'Online';
            } else {
                statusDot.className = 'status-indicator status-offline';
                statusText.textContent = 'Offline';
            }
            
            // Service Worker status
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(registration => {
                    const swStatus = document.getElementById('sw-status');
                    swStatus.textContent = registration ? 'Ativo' : 'N√£o registrado';
                });
            } else {
                document.getElementById('sw-status').textContent = 'N√£o suportado';
            }
            
            // PWA installed status
            const isInstalled = window.matchMedia('(display-mode: standalone)').matches;
            document.getElementById('pwa-installed-status').textContent = isInstalled ? 'Sim' : 'N√£o';
            
            // Notification permission
            if ('Notification' in window) {
                document.getElementById('notification-permission').textContent = Notification.permission;
            } else {
                document.getElementById('notification-permission').textContent = 'N√£o suportado';
            }
        }
        
        function setupEventListeners() {
            window.addEventListener('online', updateStatus);
            window.addEventListener('offline', updateStatus);
        }
        
        // Test functions
        window.testInstallPrompt = function() {
            const output = document.getElementById('install-output');
            output.textContent = 'üì± Testando prompt de instala√ß√£o...';
            
            if (window.pwaManager && window.pwaManager.deferredPrompt) {
                window.pwaManager.promptInstall();
                output.textContent = '‚úÖ Prompt de instala√ß√£o exibido!';
            } else {
                output.textContent = '‚ö†Ô∏è Prompt n√£o dispon√≠vel. PWA pode j√° estar instalado ou navegador n√£o suporta.';
            }
        };
        
        window.checkInstallStatus = function() {
            const output = document.getElementById('install-output');
            const isInstalled = window.matchMedia('(display-mode: standalone)').matches;
            const hasPrompt = window.pwaManager ? !!window.pwaManager.deferredPrompt : false;
            
            output.innerHTML = `
                PWA Instalado: ${isInstalled ? 'Sim' : 'N√£o'}<br>
                Prompt dispon√≠vel: ${hasPrompt ? 'Sim' : 'N√£o'}<br>
                Modo de exibi√ß√£o: ${window.matchMedia('(display-mode: standalone)').matches ? 'Standalone' : 'Browser'}
            `;
        };
        
        window.requestNotificationPermission = async function() {
            const output = document.getElementById('notification-output');
            output.textContent = 'üîî Solicitando permiss√£o...';
            
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                output.textContent = `‚úÖ Permiss√£o: ${permission}`;
                updateStatus();
            } else {
                output.textContent = '‚ùå Notifica√ß√µes n√£o suportadas neste navegador';
            }
        };
        
        window.testInAppNotification = function() {
            const output = document.getElementById('notification-output');
            
            if (window.notificationSystem) {
                window.notificationSystem.createNotification({
                    type: 'info',
                    title: 'Teste de Notifica√ß√£o',
                    message: 'Esta √© uma notifica√ß√£o de teste do sistema PWA!',
                    icon: 'üß™'
                });
                output.textContent = '‚úÖ Notifica√ß√£o in-app criada!';
            } else {
                output.textContent = '‚ùå Sistema de notifica√ß√µes n√£o carregado';
            }
        };
        
        window.testPushNotification = function() {
            const output = document.getElementById('notification-output');
            
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('PWA Demo', {
                    body: 'Esta √© uma push notification de teste!',
                    icon: '/images/logo-arquidiocese-belem.png',
                    badge: '/images/logo-arquidiocese-belem.png'
                });
                output.textContent = '‚úÖ Push notification enviada!';
            } else {
                output.textContent = '‚ùå Permiss√£o necess√°ria para push notifications';
            }
        };
        
        window.testNotificationCenter = function() {
            const output = document.getElementById('notification-output');
            
            if (window.notificationSystem) {
                window.notificationSystem.toggleNotificationCenter();
                output.textContent = '‚úÖ Central de notifica√ß√µes alternada!';
            } else {
                output.textContent = '‚ùå Sistema de notifica√ß√µes n√£o dispon√≠vel';
            }
        };
        
        window.simulateOffline = function() {
            const output = document.getElementById('offline-output');
            output.textContent = 'üì¥ Simule ir offline no DevTools (Network -> Offline)';
        };
        
        window.testOfflineCache = function() {
            const output = document.getElementById('offline-output');
            
            if (window.offlineCacheManager) {
                const status = window.offlineCacheManager.getOfflineStatus();
                output.innerHTML = `
                    Posts em cache: ${status.cachedPosts}<br>
                    A√ß√µes pendentes: ${status.pendingActions}<br>
                    √öltima sincroniza√ß√£o: ${status.lastSync || 'Nunca'}<br>
                    Status: ${status.isOnline ? 'Online' : 'Offline'}
                `;
            } else {
                output.textContent = '‚ùå Gerenciador de cache offline n√£o dispon√≠vel';
            }
        };
        
        window.testBackgroundSync = async function() {
            const output = document.getElementById('offline-output');
            
            if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
                try {
                    const registration = await navigator.serviceWorker.ready;
                    await registration.sync.register('test-sync');
                    output.textContent = '‚úÖ Background sync registrado!';
                } catch (error) {
                    output.textContent = `‚ùå Erro no background sync: ${error.message}`;
                }
            } else {
                output.textContent = '‚ùå Background sync n√£o suportado';
            }
        };
        
        window.clearOfflineData = function() {
            const output = document.getElementById('offline-output');
            
            if (window.offlineCacheManager) {
                window.offlineCacheManager.clearOfflineData();
                output.textContent = '‚úÖ Dados offline limpos!';
            } else {
                output.textContent = '‚ùå Gerenciador de cache n√£o dispon√≠vel';
            }
        };
        
        window.checkForUpdates = async function() {
            const output = document.getElementById('update-output');
            output.textContent = 'üîÑ Verificando atualiza√ß√µes...';
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        await registration.update();
                        output.textContent = '‚úÖ Verifica√ß√£o de atualiza√ß√£o conclu√≠da!';
                    } else {
                        output.textContent = '‚ùå Service Worker n√£o registrado';
                    }
                } catch (error) {
                    output.textContent = `‚ùå Erro: ${error.message}`;
                }
            } else {
                output.textContent = '‚ùå Service Workers n√£o suportados';
            }
        };
        
        window.simulateUpdate = function() {
            const output = document.getElementById('update-output');
            
            if (window.pwaManager) {
                window.pwaManager.showUpdateNotification();
                output.textContent = '‚úÖ Simula√ß√£o de atualiza√ß√£o exibida!';
            } else {
                output.textContent = '‚ùå PWA Manager n√£o dispon√≠vel';
            }
        };
        
        window.showUpdateBanner = function() {
            const output = document.getElementById('update-output');
            
            // Create update banner manually for demo
            const banner = document.createElement('div');
            banner.className = 'pwa-update-notification';
            banner.innerHTML = `
                <div class="update-content">
                    <div class="update-text">
                        <strong>Atualiza√ß√£o Dispon√≠vel</strong>
                        <p>Uma nova vers√£o est√° dispon√≠vel!</p>
                    </div>
                    <button class="update-btn" onclick="this.parentElement.parentElement.remove()">
                        Atualizar
                    </button>
                    <button class="dismiss-btn" onclick="this.parentElement.parentElement.remove()">
                        ‚úï
                    </button>
                </div>
            `;
            
            document.body.appendChild(banner);
            output.textContent = '‚úÖ Banner de atualiza√ß√£o exibido!';
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (document.body.contains(banner)) {
                    banner.remove();
                }
            }, 10000);
        };
    </script>
</body>
</html>
